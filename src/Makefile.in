#
# Copyright (c) 2008 Martin Decky
# All rights reserved.
#
# Distributed under the terms of GPL.
#

CC = @CC@
CFLAGS = @CFLAGS@ -Wall
LIBS = @LIBS@

SOURCES = \
	instr.c \
	output.c \
	utils.c \
	machine.c \
	fault.c \
	processor.c \
	text.c \
	env.c \
	cline.c \
	input.c \
	cmd.c \
	check.c \
	mem.c \
	main.c \
	gdb.c \
	parser.c \
	debug/debug.c \
	devices/ddisk.c \
	devices/dcpu.c \
	devices/dkeyboard.c \
	devices/dorder.c \
	devices/dprinter.c \
	devices/dtime.c \
	devices/device.c

OBJECTS := $(addsuffix .o,$(basename $(SOURCES)))

.PHONY: all depend clean distclean

all: msim

-include Makefile.depend

depend:
	-makedepend $(CFLAGS) -f - $(SOURCES) > Makefile.depend 2> /dev/null

$(OBJECTS): %.o: %.c
	$(CC) -c $(CFLAGS) -o $@ $<

msim: $(OBJECTS) depend
	$(CC) $(CFLAGS) $(LIBS) -o $@ $(OBJECTS)

clean:
	rm -f msim $(OBJECTS) Makefile.depend

distclean: clean
	rm -f Makefile
